# Creates a cluster with one control-plane node and one worker node
apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
metadata:
  name: my-cluster
  namespace: default
spec:
  clusterNetwork:
    services:
      cidrBlocks: ["10.96.0.0/12"]
    pods:
      cidrBlocks: ["192.168.0.0/16"]
    serviceDomain: cluster.local
  controlPlaneRef:
    apiVersion: controlplane.cluster.x-k8s.io/v1beta1
    kind: KubeadmControlPlane
    name: controlplane
    namespace: default
  infrastructureRef:
    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
    kind: DockerCluster
    name: my-cluster
    namespace: default
---
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: DockerCluster
metadata:
  name: my-cluster
  namespace: default
---
apiVersion: controlplane.cluster.x-k8s.io/v1beta1
kind: KubeadmControlPlane
metadata:
  name: controlplane
  namespace: default
spec:
  replicas: 1
  version: v1.29.2
  machineTemplate:
    infrastructureRef:
      apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
      kind: DockerMachineTemplate
      name: controlplane
      namespace: default
  kubeadmConfigSpec:
    externalCA: true
    clusterConfiguration:
      apiServer:
        certSANs:
        - localhost
        - 127.0.0.1
        - 0.0.0.0
    initConfiguration:
      nodeRegistration:
        kubeletExtraArgs:
          eviction-hard: nodefs.available<0%,nodefs.inodesFree<0%,imagefs.available<0%
    joinConfiguration:
      nodeRegistration:
        kubeletExtraArgs:
          eviction-hard: nodefs.available<0%,nodefs.inodesFree<0%,imagefs.available<0%
---
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: DockerMachineTemplate
metadata:
  name: controlplane
  namespace: default
spec:
  template:
    spec: {}
---
apiVersion: cluster.x-k8s.io/v1beta1
kind: MachineDeployment
metadata:
  name: worker-md-0
  namespace: default
spec:
  clusterName: my-cluster
  replicas: 1
  selector:
    matchLabels:
      cluster.x-k8s.io/cluster-name: my-cluster
  template:
    spec:
      version: v1.29.2
      clusterName: my-cluster
      bootstrap:
        configRef:
          apiVersion: bootstrap.cluster.x-k8s.io/v1beta1
          kind: KubeadmConfigTemplate
          name: worker
          namespace: default
      infrastructureRef:
        apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
        kind: DockerMachineTemplate
        name: worker
        namespace: default
---
apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
kind: DockerMachineTemplate
metadata:
  name: worker
  namespace: default
spec:
  template:
    spec: {}
---
apiVersion: bootstrap.cluster.x-k8s.io/v1beta1
kind: KubeadmConfigTemplate
metadata:
  name: worker
  namespace: default
spec:
  template:
    spec:
      joinConfiguration:
        nodeRegistration:
          kubeletExtraArgs:
            eviction-hard: nodefs.available<0%,nodefs.inodesFree<0%,imagefs.available<0%
---
apiVersion: v1
kind: Secret
metadata:
  name: my-cluster-ca
  labels:
    cluster.x-k8s.io/cluster-name: my-cluster
type: Opaque
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM2akNDQWRLZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJME1ETXlOakUwTXpnek1Gb1hEVE0wTURNeU5ERTBORE16TUZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBUEZuCkhuOVZJR01nRHYrOWM1Q3Z1Wi9kZW1jaXh1azgvalFXU0dnNkFWZDhLWEpnNHJ1aDZPWXRiV0NySHduYSs3K1UKUWd2TUtVRzI0S1ZrMTBldERENFlxb2VuTEo0amFqc3BTMTFxVWFucUJiMGV2OWtXMVdmcUt2c1QrZ01wTVdicgo4N1kvVDB2cUE2L3hFYnBVWGhmYVNRVVZNYmUzRUpRQUt0c2gvd3U1SEVBM3g3US8xTVl3MkZMOVlPRk1JKzVCCjdIYThKMS8wSitHRklnOHN4NUFpZnMzV1gySE43QnEvU1o3N0F3UWhoQis0d1FQQmp3eUlXd21LVGNQdTU2TXAKS3R6R2tHeUdmWExEdGlnRnNJQVhBVXR6bVdwMStnKzNhQ0ZqbGV6ZW02a2RaSHBrRXY0ZlN6SFhrNUJEQzRydApmKzdGaTgyb3RVVVQwZHowS2MwQ0F3RUFBYU5GTUVNd0RnWURWUjBQQVFIL0JBUURBZ0trTUJJR0ExVWRFd0VCCi93UUlNQVlCQWY4Q0FRQXdIUVlEVlIwT0JCWUVGTzhIRWx2TDNBeWZHWWdRaDlGWHJLMXBFT3RCTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQ3E0MC80SU9pSWg3SUVGWm0zQVFlOTFKU2RCYlBtR3ZzWndpTjhUZk5WWFV0ZQp6WXp3Q3hxejRCTUwzRUpvYTREYlVSc1BnczZnelEvcXNrSENrRVB2TG1ZMlpCL3NKTU9BbzlBRWVmWGNaWlhXCkZ6UnZNYXhNN0E0WWlaV25Fb3MxQzRSSWZRVmRMRHJ6aHZ4SzR1NVg4Qlk3QSttTUZZMzh3KzNFd2dhYm9KQWMKVDI2UFlFOVNERmZlaDZTZCtGOUUwZHprMXJwOXNRbGo2WnZjM2R2Umxka3lFemt3RlRMa25NU251L21hOHpRQwpxM0x1andiMnBYUTlXVHRzZ3lGYXhaWEd4VmtNbVcrUXl1VFNRZHcyTy8wSkFKbTdTV3lPdDlWZkdpZzlCK0V0CndUd3U1NFMzUmNXN2FhKzkwQzdXS2JuME9kakxGa0hxeVJCdWdDdUkKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
  #tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcFFJQkFBS0NBUUVBOFdjZWYxVWdZeUFPLzcxemtLKzVuOTE2WnlMRzZUeitOQlpJYURvQlYzd3BjbURpCnU2SG81aTF0WUtzZkNkcjd2NVJDQzh3cFFiYmdwV1RYUjYwTVBoaXFoNmNzbmlOcU95bExYV3BScWVvRnZSNi8KMlJiVlorb3EreFA2QXlreFp1dnp0ajlQUytvRHIvRVJ1bFJlRjlwSkJSVXh0N2NRbEFBcTJ5SC9DN2tjUURmSAp0RC9VeGpEWVV2MWc0VXdqN2tIc2Ryd25YL1FuNFlVaUR5ekhrQ0oremRaZlljM3NHcjlKbnZzREJDR0VIN2pCCkE4R1BESWhiQ1lwTncrN25veWtxM01hUWJJWjljc08yS0FXd2dCY0JTM09aYW5YNkQ3ZG9JV09WN042YnFSMWsKZW1RUy9oOUxNZGVUa0VNTGl1MS83c1dMemFpMVJSUFIzUFFwelFJREFRQUJBb0lCQVFDUmpqZlpWeDY4Sml4bApEM3FMRnltNXR2V0RFbmtWVVcyRlFwcE9IZ3VKRUpoOUd1WWJkTGpWY1RhdVB2L3NGVm9PWGZxazJtbFY4a3JwCjd5L1BUQXhCdE9XOS9aTHRselVLancrZU4ra2Rwcm5uR285YSttV2F6cHN6NFF1eXREZlJjeHYwRzZCWWliWEgKZEhmWC9kN3VTdlFVV0g4dDR2ZmdCV25SejJIVlVwQm9aN2RGM0V6RjFzVi81b0lzUWhOMGVpdkhEbmtBN3E1bAp4T1hQTXo0QVZJMTlyRkVPYlM2VmlFSVNYOG93d1IrNUlTTXlvMUkwRHdxcC9IQ1c3N0o3NU5QVFRoZUFqUmkyCi9xdytqV2g4d0UvSHUwbVZMSjhOeU1rcXdLdUUvODNSRkxDOUtIbUtXcEJDbWVrSkZmcDg0bTFaajlKVU5QdzIKeUhDc3VMTUJBb0dCQVBneTdvUCtwVDJCSG40cUhXNXRnWEhEZXZBbVBZN1dCalZ3Qkt3MFlGdUgyZ2J4Wm5HZgp4Nmx2S2ZKMGd4UE0wVkFnZ0tDbVI2Lzg4OFlzRzdOVGxUbVRmREhZWWhtcWV2bmFJTFR4b0QrMCtLR1duNjhjClFCWVRmUEdvazdMN0ZWYTdCU1FZY2RaR2xBV0RyV2IySmIxQUE2MDM1azRsM1paOHd5V0JScEF4QW9HQkFQajkKZ1FoVXl5bG9qT0F4Yzc2YmRyem5tVXhoSGM3dmFMUXlNeFhSZzhDck5nR0dmd1RHL0VCU0NKdEdpL1pDMHNkRwpaZkNCRjBQS2RmeGlDWm41K2EvYUYwV2Q1RlEvK3lEa0V6Y2hjb2g5aHo0WW9INkhMaDF5S1hoa2UrTE4yVGE1ClJFUlBPcElCalc2WEhSQjNaWTQ2amxWeXczejJTai9aaEhwZEJFaGRBb0dBU01KRmdaUkl4SHJ4Z1hLL0pmd2MKRWttSDVKYVJQU29vcjhtaTFRaVZwcjl3ZnRDTmc0bWZjbUFRSCs5ZjdaSUJXa2ZzN1N0Um9KbTZyTUdKYlV4MwpWbVdSNXRyVUIwb2V1dGZpOXFoT25kNWpkSnMvUElvL2p6a3ZTM2hycy9BL0ZTbkdIQXErZEY1RVRrbUhyOE5BCjFQWExIaUJnOTAvS1lhODVWZWxMMGtFQ2dZRUEyYmo2aXFseTJXdWx2Q2toOSt1RGdaM1hDOVhrTmQ1ZEpTeTgKUlBqbkI2UHUzcGlZR3pwUXU0SEFLdDhlWmlGNnBHd25tWTJZSlZ3MW5aS3dxS2JRc2ZlMzM5VTRJbityL2MvUwpDYVJDdloxZWxHcitkSVdLU285WU9nRkwzMEIzRHdZajdzT0ZDTVU0d2hwN2ZMbWE0U3JNNldVb0VlNWZjTU9vCnQwTDlDclVDZ1lFQW5lVGFJSXd5TFlmZUdOWXRHWFVtcVlrVVNqakt3Y1NDU0pXOXcvMnB3SWNjZnY0QnRCak4KOFlueXZpWGF3TTVQMXJ2eExRWDZQUkpRdkh2a21OSkwveWRuUkRHajlJWVpFQnNrRDJ5Z3dCVENQejNPT0dkdwo1Um1raGtGNjErVU1oUmpCRHdkSjJ2MHhiUStmcXNMaWcybExBV3ROOGJRVUJOcjd6eHIxYndzPQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
